use strict;
use warnings;

# ==============================
# ВВОД И ПРОВЕРКА ДАННЫХ
# ==============================

print "Введите число дисков: ";
chomp(my $n = <> // 0);   # читаем ввод, убираем \n, если undef → 0
$n = int($n);             # приводим к целому

die "Неверное число дисков\n" if $n <= 0;   # проверка, чтобы число было > 0

# ==============================
# ИНИЦИАЛИЗАЦИЯ СТЕРЖНЕЙ
# ==============================
# У нас 3 стержня: a, b, c
# На стержне a изначально лежат все диски:
#   снизу — самый большой (n), сверху — самый маленький (1).
# Для этого используем reverse 1..$n
# Стержни b и c изначально пустые.
my %rods = (
    a => [reverse 1..$n],
    b => [],
    c => [],
);

# ==============================
# ФУНКЦИЯ ПЕЧАТИ СОСТОЯНИЯ
# ==============================
# Печатает текущее содержимое каждого стержня
sub print_rods {
    foreach my $rod (qw(a b c)) {
        print "$rod: [", join(", ", @{$rods{$rod}}), "]\n";
    }
    print "\n";
}

# ==============================
# РЕКУРСИЯ ХАНОЙСКИХ БАШЕН
# ==============================
# hanoi($num, $from, $to, $aux)
#   $num  — сколько дисков переносим
#   $from — исходный стержень
#   $to   — конечный стержень
#   $aux  — вспомогательный стержень
#
# Алгоритм:
#   1. Переносим n-1 дисков со $from на $aux (используя $to как вспомогательный)
#   2. Переносим последний (самый большой из этой группы) диск со $from на $to
#   3. Переносим n-1 дисков с $aux на $to (используя $from как вспомогательный)
sub hanoi {
    my ($num, $from, $to, $aux) = @_;
    return if $num == 0;   # базовый случай: нечего переносить

    # 1. Перенос n-1 дисков со стержня from → aux
    hanoi($num-1, $from, $aux, $to);

    # 2. Перенос последнего диска (pop из from → push в to)
    my $disk = pop @{$rods{$from}};
    push @{$rods{$to}}, $disk;

    print "Перенос диска диаметра $disk со стержня $from на стержень $to.\n";
    print_rods();

    # 3. Перенос n-1 дисков со стержня aux → to
    hanoi($num-1, $aux, $to, $from);
}

# ==============================
# ОСНОВНОЙ ВЫПОЛНЕНИЕ
# ==============================

print "Начальное состояние стержней:\n";
print_rods();

# Запуск рекурсии: переносим все $n дисков со стержня a на стержень c,
# используя стержень b как вспомогательный.
hanoi($n, 'a', 'c', 'b');

print "Все диски перенесены на стержень c.\n";
